<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard - Web Scraper & Email Sender</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #eef2f7;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            background: white;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h2 {
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
        }
        .nav-tabs .nav-link {
            font-weight: 600;
            font-size: 1.1em;
            color: #555;
            border-radius: 8px 8px 0 0;
            padding: 12px 25px;
            margin-right: 8px;
            transition: all 0.3s ease;
        }
        .nav-tabs .nav-link.active {
            background-color: #3498db;
            color: white !important;
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
            border-color: #3498db #3498db transparent;
        }
        .tab-content {
            min-height: 400px;
            padding: 25px 15px 15px 15px;
            border: 1px solid #ddd;
            border-top: 0;
            border-radius: 0 0 12px 12px;
            background: #fafafa;
            animation: fadeIn 0.6s ease;
        }
        @keyframes fadeIn {
            from {opacity:0;}
            to {opacity:1;}
        }
        .form-card {
            background: white;
            padding: 25px 30px;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
        }
        label {
            font-weight: 600;
            color: #444;
        }
        input.form-control, textarea.form-control {
            border-radius: 8px;
            border: 1.5px solid #ccc;
            transition: border-color 0.3s ease;
        }
        input.form-control:focus, textarea.form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
        }
        button.btn-primary {
            background-color: #3498db;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1em;
        }
        button.btn-primary:hover {
            background-color: #2980b9;
        }
        .progress {
            height: 22px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
        }
        .status, #status-message, #email-status {
            margin-top: 18px;
            font-size: 1em;
            font-weight: 600;
        }
        .status.success, #email-status.success {
            color: #27ae60;
        }
        .status.error, #email-status.error {
            color: #e74c3c;
        }
        .spinner-border {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center">Dashboard</h2>
        <ul class="nav nav-tabs justify-content-center" id="dashboardTabs" role="tablist" aria-label="Dashboard navigation">
            <li class="nav-item">
                <a
                  class="nav-link active"
                  id="scraper-tab"
                  data-toggle="tab"
                  href="#scraper"
                  role="tab"
                  aria-controls="scraper"
                  aria-selected="true"
                ><i class="fas fa-search"></i> Web Scraper</a>
            </li>
            <li class="nav-item">
                <a
                  class="nav-link"
                  id="email-tab"
                  data-toggle="tab"
                  href="#email"
                  role="tab"
                  aria-controls="email"
                  aria-selected="false"
                ><i class="fas fa-envelope"></i> Email Sender</a>
            </li>
            <li class="nav-item">
                <a
                  class="nav-link"
                  id="placeholder-tab"
                  data-toggle="tab"
                  href="#placeholder"
                  role="tab"
                  aria-controls="placeholder"
                  aria-selected="false"
                ><i class="fas fa-plus-circle"></i> More Features</a>
            </li>
        </ul>
        <div class="tab-content" id="dashboardTabsContent">
            <div
              class="tab-pane fade show active"
              id="scraper"
              role="tabpanel"
              aria-labelledby="scraper-tab"
            >
                <div class="form-card">
                    <form id="scrape-form" novalidate>
                        <label for="url">Job Listing URL</label>
                        <input
                          type="url"
                          class="form-control"
                          id="url"
                          name="url"
                          placeholder="Paste job board URL here"
                          required
                        />
                        <small class="form-text text-muted mt-1">Enter the complete URL of the job listings page to scrape.</small>
                        <button type="submit" class="btn btn-primary mt-4">
                          Start Fetching Jobs
                          <span id="scraper-spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display:none;"></span>
                        </button>
                    </form>
                    <div class="progress mt-3" id="progress-bar" style="display:none;">
                        <div
                          class="progress-bar progress-bar-striped progress-bar-animated"
                          role="progressbar"
                          style="width: 0%"
                          id="progress-status"
                        ></div>
                    </div>
                    <div id="status-message" class="status"></div>
                </div>
            </div>

            <div
              class="tab-pane fade"
              id="email"
              role="tabpanel"
              aria-labelledby="email-tab"
            >
                <div class="form-card">
                  <form id="email-form" novalidate>
                      <label for="recipients">Recipients (comma-separated)</label>
                      <input
                        type="text"
                        id="recipients"
                        class="form-control"
                        placeholder="e.g. alice@example.com, bob@example.com"
                        required
                      />
                      <small class="form-text text-muted">Separate multiple emails with commas.</small>

                      <label for="subject" class="mt-3">Subject</label>
                      <input
                        type="text"
                        id="subject"
                        class="form-control"
                        placeholder="Email subject"
                      />

                      <label for="emailbody" class="mt-3">Email Body</label>
                      <textarea
                        id="emailbody"
                        class="form-control"
                        rows="6"
                        placeholder="Write your email here"
                        required
                      ></textarea>

                      <button type="submit" class="btn btn-primary mt-4">
                        Send Email
                        <span id="email-spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display:none;"></span>
                      </button>
                  </form>
                  <div id="email-status" class="status"></div>
                </div>
            </div>

            <div
              class="tab-pane fade"
              id="placeholder"
              role="tabpanel"
              aria-labelledby="placeholder-tab"
            >
                <div class="form-card">
                    <p style="font-size: 1.1em; color: #777; text-align:center; margin-top: 80px;">
                      Add your future features here.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"
    ></script>

    <script>
      const scraperSpinner = document.getElementById('scraper-spinner');
      const emailSpinner = document.getElementById('email-spinner');

      // Web scraper form submit
      document.getElementById("scrape-form").addEventListener("submit", function (e) {
        e.preventDefault();
        const url = document.getElementById("url").value;
        const progressBar = document.getElementById("progress-bar");
        const progressStatus = document.getElementById("progress-status");
        const statusMessage = document.getElementById("status-message");

        progressBar.style.display = "block";
        progressStatus.style.width = "0%";
        statusMessage.textContent = "";
        scraperSpinner.style.display = "inline-block";

        fetch("/scrape-jobs", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url }),
        })
          .then((response) => response.json())
          .then((data) => {
            scraperSpinner.style.display = "none";
            statusMessage.className = "status success";
            statusMessage.textContent = `Scrape completed. ${data.jobs ? data.jobs.length : 0} jobs found.`;
            progressStatus.style.width = "100%";
          })
          .catch((err) => {
            scraperSpinner.style.display = "none";
            statusMessage.className = "status error";
            statusMessage.textContent = "Error: " + err.message;
            progressBar.style.display = "none";
          });
      });

      // Email sender form submit
      document.getElementById("email-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const recipients = document.getElementById("recipients").value;
        const subject = document.getElementById("subject").value;
        const emailbody = document.getElementById("emailbody").value;
        const emailStatus = document.getElementById("email-status");

        emailStatus.textContent = "";
        emailSpinner.style.display = "inline-block";

        fetch("/send-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ recipients, subject, emailbody }),
        })
        .then(response => response.json())
        .then(data => {
          emailSpinner.style.display = "none";
          if (data.error) {
            emailStatus.className = "status error";
            emailStatus.textContent = "Error: " + data.error;
          } else {
            emailStatus.className = "status success";
            emailStatus.textContent = "Email sent successfully!";
            document.getElementById("email-form").reset();
          }
        })
        .catch(err => {
          emailSpinner.style.display = "none";
          emailStatus.className = "status error";
          emailStatus.textContent = "Error: " + err.message;
        });
      });
    </script>
</body>
</html>
